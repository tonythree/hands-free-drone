graphs:

  - id: Broker
    nodes:
    - id: proxy
      module: timeflux.nodes.zmq
      class: Broker

  - id: OpenBCI
    nodes:
    - id: acquire
      module: timeflux_openbci.nodes.driver
      class: OpenBCI
      params:
        board: ganglion
        serial_port: /dev/cu.usbmodem11
        debug: false

    - id: bandpass
      module: timeflux_dsp.nodes.filters
      class: IIRFilter
      params:
        rate: 250
        order: 3
        frequencies: [1, 40]

    # - id: display
    #   module: timeflux.nodes.debug
    #   class: Display

    - id: pub_openbci
      module: timeflux.nodes.zmq
      class: Pub
      params:
        topic: openbci

    - id: peaks
      module: timeflux_dsp.nodes.peaks
      class: LocalDetect
      params:
        delta: 0.1
        tol: 0.5

    - id: pub_detector
      module: timeflux.nodes.zmq
      class: Pub
      params:
        topic: detector

    edges:
    - source: acquire
      target: bandpass
    - source: bandpass
      target: pub_openbci
    - source: bandpass
      target: peaks
    - source: peaks
      target: pub_detector
    rate: 10

  - id: Monitor
    nodes:
    - id: sub
      module: timeflux.nodes.zmq
      class: Sub
      params:
        topics: [ openbci, detector ]
    - id: ui
      module: timeflux_ui.nodes.ui
      class: UI
    edges:
      - source: sub:openbci
        target: ui:openbci
      - source: sub:detector
        target: ui:detector
    rate: 10
